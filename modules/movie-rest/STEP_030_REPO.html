
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://androidbyexample.com/modules/movie-rest/STEP_030_REPO.html">
      
      
        <link rel="prev" href="STEP_020_REPO.html">
      
      
        <link rel="next" href="STEP_040_REPO.html">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.31">
    
    
      
        <title>Server code - Android By Example</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.3cba04c6.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 64C0 28.7 28.7 0 64 0h160v128c0 17.7 14.3 32 32 32h128v288c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V64zm384 64H256V0l128 128z"/></svg>');}</style>



    
    
      
        <script src="https://unpkg.com/iframe-worker/shim"></script>
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Android By Example" class="md-header__button md-logo" aria-label="Android By Example" data-md-component="logo">
      
  <img src="../../android.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Android By Example
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Server code
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Android By Example" class="md-nav__button md-logo" aria-label="Android By Example" data-md-component="logo">
      
  <img src="../../android.png" alt="logo">

    </a>
    Android By Example
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Introduction
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Introduction
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_010_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About This Site
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_020_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About Your Instructor
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_040_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Content License
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_050_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Source Code License
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_060_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_070_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Course Hardware and Software
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_080_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Assignments
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_090_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Grading
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/STEP_100_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Third-Party and Course Sample Code
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Week 1 (1/23-1/29)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Week 1 (1/23-1/29)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kotlin Primer
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Kotlin Primer
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin-primer/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../kotlin-primer/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Video
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/STEP_020_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Layer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/STEP_030_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Domain Layer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/STEP_040_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    User-Interface Layer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/STEP_050_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Objects
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/STEP_060_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/STEP_070_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Concurrency
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/STEP_080_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Unidirectional Data Flow
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Android Studio
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Android Studio
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../android-studio/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Video
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Week 2 (1/30-2/5)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Week 2 (1/30-2/5)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Jetpack Compose Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Jetpack Compose Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_020_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Composable Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_030_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    String literals
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_040_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_050_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compose Optimizations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_060_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Where do you store state?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-concepts/STEP_070_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Density
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Initial Movies UI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Initial Movies UI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial Movie UI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_020_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update versions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_030_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_040_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Create initial screens
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_050_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refactor Scaffold Use
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-1/STEP_060_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Flesh out the screens
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Week 3 (2/6-2/12)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Week 3 (2/6-2/12)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_1" >
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Room
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Room
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../room/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entities
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_10_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Relationships
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_20_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Room Basics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_25_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Room Relations
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_30_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Suspending Functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../room/STEP_40_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The Repository
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Movies Database
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Movies Database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_020_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add new modules
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_030_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add Room dependencies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_035_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add Android SDK and JDK to version catalog
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_040_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module Dependencies
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_050_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entities, DAO and Database
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_060_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Repository Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_070_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Modifying the view model to use real data
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_080_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fix movie list
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_090_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fetch data for movie display
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-db/STEP_100_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Viewing the Database
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Week 4 (2/13-2/19)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Week 4 (2/13-2/19)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_1" >
        
          
          <label class="md-nav__link" for="__nav_5_1" id="__nav_5_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Compose Lists
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_1">
            <span class="md-nav__icon md-icon"></span>
            Compose Lists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-lists/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-lists/STEP_020_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fixed UIs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-lists/STEP_030_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic UIs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-lists/STEP_040_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selection
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Movies UI - Lists
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Movies UI - Lists
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_020_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Convert to LazyColumn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_030_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selection Tracking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_040_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Selections in the UI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_050_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contextual Top Bar
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_060_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Refactor time!
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_070_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add Actors and Ratings
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_080_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Better Movie Icon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-2/STEP_090_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Wrapup
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Week 5 (2/20-2/26)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Week 5 (2/20-2/26)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_1" id="__nav_6_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Compose Text Fields
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_1">
            <span class="md-nav__icon md-icon"></span>
            Compose Text Fields
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-text-fields/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-text-fields/STEP_020_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Races
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-text-fields/STEP_030_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fixing State Races
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../compose-text-fields/STEP_040_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heads up!
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Movies UI - Updates
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_2">
            <span class="md-nav__icon md-icon"></span>
            Movies UI - Updates
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/STEP_020_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Display-screen list cleanup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/STEP_030_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deleting from the display screens
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-ui-3/STEP_040_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Editing a movie
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Week 6 (2/27-3/5)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Week 6 (2/27-3/5)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1" >
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Movies Widget
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Movies Widget
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/STEP_020_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Widget Declaration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../movie-widget/STEP_030_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Widget UI and Data
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Speech
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Speech
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../speech/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../speech/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Video
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Week 7 (3/6-3/12)
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Week 7 (3/6-3/12)
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Google Map
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            Google Map
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_020_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Find Your Fingerprint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_030_FULL.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Google Console Project
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_040_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Set up a map
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_050_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add a Marker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_060_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initial Position
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_070_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Loading Spinner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_080_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Map Types
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_090_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Current Location
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_100_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Jump to Current Location
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_110_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Add Top Bar
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_120_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Copy Icons
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_130_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Manage Car Location
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_140_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dragging a Marker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_150_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Navigating
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../google-maps/STEP_160_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lat/Lon Bounds
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" checked>
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    REST services
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            REST services
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="repo.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sample Repository
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="STEP_020_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rest server module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
      <a href="STEP_030_REPO.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Server code
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="STEP_040_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Server address
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="STEP_050_REPO.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    REST client repository
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
<h4>REST services</h4>

<h1>Server code</h1>

<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You won't need a server for any of your projects, so we'll go through this pretty quickly
just to make the example work.</p>
</div>
<p>First, we need some data for the server. Because the server isn't running Android, we can't
use our Android data library, so we'll redefine the objects using Jackson for JSON serialization.
As Kotlin MultiPlatform (KMP) grows, we may start seeing Room used on non-Android platforms,
which would simplify this setup.</p>
<details class="success" open>
<summary><a class="find-button" href="#030-actor">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Actor.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>
<span class="k">import</span> <span class="nn">java.util.UUID</span>

<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">Actor</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">id</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="n">UUID</span><span class="p">.</span><span class="n">randomUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">ActorWithFilmography</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;filmography&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">filmography</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">RoleWithMovie</span><span class="p">&gt;,</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">RoleWithMovie</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;character&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">character</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;orderInCredits&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">orderInCredits</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span></ins>
<ins><span class="p">)</span></ins></pre>
</div>
</div>
</details>

<details class="success" open>
<summary><a class="find-button" href="#030-movie">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Movie.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>
<span class="k">import</span> <span class="nn">java.util.UUID</span>

<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">id</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="n">UUID</span><span class="p">.</span><span class="n">randomUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">title</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">description</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;ratingId&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">ratingId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">MovieWithCast</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;cast&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">cast</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">RoleWithActor</span><span class="p">&gt;,</span></ins>
<ins><span class="p">)</span></ins>

<span class="n">@XmlRootElement</span>
<span class="c1">// ...</span></pre>
</div>
</div>
</details>

<details class="success" open>
<summary><a class="find-button" href="#030-rating">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Rating.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>
<span class="k">import</span> <span class="nn">java.util.UUID</span>

<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">Rating</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">id</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="n">UUID</span><span class="p">.</span><span class="n">randomUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">description</span><span class="p">:</span> <span class="n">String</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">RatingWithMovies</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">rating</span><span class="p">:</span> <span class="n">Rating</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movies&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">movies</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Movie</span><span class="p">&gt;,</span></ins>
<ins><span class="p">)</span></ins></pre>
</div>
</div>
</details>

<details class="success" open>
<summary><a class="find-button" href="#030-role">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Role.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>
<span class="k">import</span> <span class="nn">jakarta.xml.bind.annotation.XmlRootElement</span>

<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">class</span> <span class="nc">Role</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movieId&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">movieId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;actorId&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">actorId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;character&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">character</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;orderInCredits&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">orderInCredits</span><span class="p">:</span> <span class="n">Int</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">class</span> <span class="nc">ExpandedRole</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;character&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">character</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;orderInCredits&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">orderInCredits</span><span class="p">:</span> <span class="n">Int</span></ins>
<ins><span class="p">)</span></ins></pre>
</div>
</div>
</details>

<p>Next, we set up a REST controller class that Jersey will load and use to handle incoming
HTTP requests. Note that the data is entirely in memory; we're just taking a quick look at
how the data is transferred from the server using JSON to the client. Jersey and Jackson manage the
requests and data marshalling for us.</p>
<details class="success" open>
<summary><a class="find-button" href="#030-controller">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RestController.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>


<ins><span class="c1">// NOTE: If Room were cross platform I would have directly used</span></ins>
<ins><span class="c1">//       our data module to store things in a database in this</span></ins>
<ins><span class="c1">//       server. Unfortunately, it&#39;s Android-only, so I&#39;m</span></ins>
<ins><span class="c1">//       implementing an in-memory set of maps to track the</span></ins>
<ins><span class="c1">//       data. Kinda gross, but developing a real server isn&#39;t</span></ins>
<ins><span class="c1">//       important for the class. The important thing is how we</span></ins>
<ins><span class="c1">//       can communicate with the server</span></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">response</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">Response</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="n">status</span><span class="p">).</span><span class="n">entity</span><span class="p">(</span><span class="n">entity</span><span class="p">).</span><span class="n">build</span><span class="p">()</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">ok</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">notFound</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">NOT_FOUND</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">created</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">CREATED</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
<ins></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">moviesByIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Movie</span><span class="p">&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">actorsByIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Actor</span><span class="p">&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">ratingsByIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Rating</span><span class="p">&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">rolesByMovieIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Role</span><span class="p">&gt;&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">rolesByActorIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Role</span><span class="p">&gt;&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">moviesByRatingIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Movie</span><span class="p">&gt;&gt;()</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundRating</span> <span class="p">=</span> <span class="n">Rating</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">)</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundMovie</span> <span class="p">=</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">,</span> <span class="s">&quot;--&quot;</span><span class="p">)</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundMovieWithRoles</span> <span class="p">=</span> <span class="n">MovieWithCast</span><span class="p">(</span><span class="n">notFoundMovie</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">())</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundActor</span> <span class="p">=</span> <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">)</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundActorWithRoles</span> <span class="p">=</span> <span class="n">ActorWithFilmography</span><span class="p">(</span><span class="n">notFoundActor</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">())</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundRatingWithMovies</span> <span class="p">=</span> <span class="n">RatingWithMovies</span><span class="p">(</span><span class="n">notFoundRating</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">())</span></ins>
<ins></ins>
<ins><span class="n">@Path</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span></ins>
<ins><span class="k">class</span> <span class="nc">RestController</span> <span class="p">{</span></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getRatings</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">ratingsByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">})</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getMovies</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">title</span> <span class="p">})</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getMovie</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="n">ok</span><span class="p">(</span><span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">])</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getActors</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">actorsByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">name</span> <span class="p">})</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}/movies&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getRatingWithMovies</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">RatingWithMovies</span> <span class="p">=</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">rating</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="k">val</span> <span class="py">movies</span> <span class="p">=</span> <span class="n">moviesByRatingIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span></ins>
<ins>            <span class="n">RatingWithMovies</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span> <span class="n">movies</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="o">?:</span> <span class="n">notFoundRatingWithMovies</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}/cast&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getMovieWithRoles</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">MovieWithCast</span> <span class="p">=</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">movie</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="k">val</span> <span class="py">roles</span> <span class="p">=</span></ins>
<ins>                <span class="n">rolesByMovieIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span></ins>
<ins>                    <span class="o">?.</span><span class="n">map</span> <span class="p">{</span> <span class="n">role</span> <span class="p">-&gt;</span></ins>
<ins>                        <span class="n">RoleWithActor</span><span class="p">(</span></ins>
<ins>                            <span class="n">actor</span> <span class="p">=</span> <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">role</span><span class="p">.</span><span class="n">actorId</span><span class="p">]</span> <span class="o">?:</span> <span class="k">throw</span> <span class="n">IllegalStateException</span><span class="p">(),</span></ins>
<ins>                            <span class="n">character</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">character</span><span class="p">,</span></ins>
<ins>                            <span class="n">orderInCredits</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">orderInCredits</span><span class="p">,</span></ins>
<ins>                        <span class="p">)</span></ins>
<ins>                    <span class="p">}</span></ins>
<ins>                    <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span></ins>
<ins></ins>
<ins>            <span class="n">MovieWithCast</span><span class="p">(</span><span class="n">movie</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="o">?:</span> <span class="n">notFoundMovieWithRoles</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}/filmography&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getActorWithRoles</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">ActorWithFilmography</span> <span class="p">=</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">actor</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="k">val</span> <span class="py">roles</span> <span class="p">=</span></ins>
<ins>                <span class="n">rolesByActorIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span></ins>
<ins>                    <span class="o">?.</span><span class="n">map</span> <span class="p">{</span> <span class="n">role</span> <span class="p">-&gt;</span></ins>
<ins>                        <span class="n">RoleWithMovie</span><span class="p">(</span></ins>
<ins>                            <span class="n">movie</span> <span class="p">=</span> <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">role</span><span class="p">.</span><span class="n">movieId</span><span class="p">]</span> <span class="o">?:</span> <span class="k">throw</span> <span class="n">IllegalStateException</span><span class="p">(),</span></ins>
<ins>                            <span class="n">character</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">character</span><span class="p">,</span></ins>
<ins>                            <span class="n">orderInCredits</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">orderInCredits</span><span class="p">,</span></ins>
<ins>                        <span class="p">)</span></ins>
<ins>                    <span class="p">}</span></ins>
<ins>                    <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span></ins>
<ins>            <span class="n">ActorWithFilmography</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="o">?:</span> <span class="n">notFoundActorWithRoles</span></ins>
<ins></ins>
<ins>    <span class="n">@PUT</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">updateMovie</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">movie</span></ins>
<ins>        <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">getOrPut</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="n">ratingId</span><span class="p">)</span> <span class="p">{</span> <span class="n">mutableListOf</span><span class="p">()</span> <span class="p">}.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@PUT</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">updateActor</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">actor</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@PUT</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">updateRating</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">rating</span><span class="p">:</span> <span class="n">Rating</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">rating</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">operator</span> <span class="k">fun</span> <span class="nf">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Role</span><span class="p">&gt;&gt;.</span><span class="k">set</span><span class="p">(</span><span class="n">id1</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">id2</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="k">val</span> <span class="py">roles</span> <span class="p">=</span> <span class="k">this</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span> <span class="o">?:</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Role</span><span class="p">&gt;().</span><span class="n">apply</span> <span class="p">{</span> <span class="k">this</span><span class="n">@set</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span> <span class="p">=</span> <span class="k">this</span> <span class="p">}</span></ins>
<ins>        <span class="n">roles</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span> <span class="p">=</span> <span class="n">role</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">operator</span> <span class="k">fun</span> <span class="nf">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Role</span><span class="p">&gt;&gt;.</span><span class="k">get</span><span class="p">(</span><span class="n">id1</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">id2</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>        <span class="k">this</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="n">id2</span><span class="p">)</span></ins>
<ins></ins>
<ins>    <span class="n">@POST</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">createRating</span><span class="p">(</span><span class="n">@Context</span> <span class="n">uriInfo</span><span class="p">:</span> <span class="n">UriInfo</span><span class="p">,</span> <span class="n">rating</span><span class="p">:</span> <span class="n">Rating</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">rating</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">rating</span></ins>
<ins>        <span class="k">return</span> <span class="n">created</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@POST</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">createMovie</span><span class="p">(</span><span class="n">@Context</span> <span class="n">uriInfo</span><span class="p">:</span> <span class="n">UriInfo</span><span class="p">,</span> <span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">movie</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">movie</span></ins>
<ins>        <span class="k">return</span> <span class="n">created</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@POST</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">createActor</span><span class="p">(</span><span class="n">@Context</span> <span class="n">uriInfo</span><span class="p">:</span> <span class="n">UriInfo</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">actor</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">actor</span></ins>
<ins>        <span class="k">return</span> <span class="n">created</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@DELETE</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">deleteMovie</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="k">if</span> <span class="p">(</span><span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>            <span class="n">notFound</span><span class="p">(</span><span class="m">0</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></ins>
<ins>            <span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">movies</span> <span class="p">-&gt;</span></ins>
<ins>                <span class="n">movies</span><span class="p">.</span><span class="n">removeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">==</span> <span class="n">id</span><span class="p">}</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">// remove all roles</span></ins>
<ins>            <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">roles</span> <span class="p">-&gt;</span></ins>
<ins>                <span class="n">roles</span><span class="p">.</span><span class="n">removeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">movieId</span> <span class="p">==</span> <span class="n">id</span> <span class="p">}</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@DELETE</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">deleteActor</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="k">if</span> <span class="p">(</span><span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>            <span class="n">notFound</span><span class="p">(</span><span class="m">0</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></ins>
<ins>            <span class="n">actorsByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">// remove all roles</span></ins>
<ins>            <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">roles</span> <span class="p">-&gt;</span> <span class="c1">// remove filmography for those movies</span></ins>
<ins>                <span class="n">roles</span><span class="p">.</span><span class="n">removeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">actorId</span> <span class="p">==</span> <span class="n">id</span> <span class="p">}</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@DELETE</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">deleteRating</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="k">if</span> <span class="p">(</span><span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>            <span class="n">notFound</span><span class="p">(</span><span class="m">0</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></ins>
<ins>            <span class="n">ratingsByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="c1">// delete associated movies</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">forEach</span> <span class="p">{</span></ins>
<ins>                <span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertMovies</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newMovies</span><span class="p">:</span> <span class="n">Movie</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newMovies</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">movie</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">movie</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">movie</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="n">ratingId</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertActors</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newActors</span><span class="p">:</span> <span class="n">Actor</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newActors</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">actor</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">actor</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">actor</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertRatings</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newRatings</span><span class="p">:</span> <span class="n">Rating</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newRatings</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">rating</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">rating</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">rating</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertRoles</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newRoles</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newRoles</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">role</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">role</span><span class="p">.</span><span class="n">actorId</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">role</span><span class="p">)</span></ins>
<ins>            <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">role</span><span class="p">.</span><span class="n">movieId</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">role</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">K</span>, <span class="n">V</span><span class="p">&gt;</span> <span class="nf">MutableMap</span><span class="p">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">V</span><span class="p">&gt;&gt;.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">K</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>        <span class="k">this</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">?:</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">V</span><span class="p">&gt;().</span><span class="n">apply</span> <span class="p">{</span></ins>
<ins>            <span class="k">this</span><span class="n">@getOrCreate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">=</span> <span class="k">this</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;reset&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">resetDatabase</span><span class="p">():</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins></ins>
<ins>        <span class="n">insertRatings</span><span class="p">(</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r0&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;Not Rated&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Not yet rated&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r1&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;G&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;General Audiences&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r2&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;PG&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Parental Guidance Suggested&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r3&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;PG-13&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Unsuitable for those under 13&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r4&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Restricted - 17 and older&quot;</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins></ins>
<ins>        <span class="n">insertMovies</span><span class="p">(</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m1&quot;</span><span class="p">,</span> <span class="s">&quot;The Transporter&quot;</span><span class="p">,</span> <span class="s">&quot;Jason Statham kicks a guy in the face&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m2&quot;</span><span class="p">,</span> <span class="s">&quot;Transporter 2&quot;</span><span class="p">,</span> <span class="s">&quot;Jason Statham kicks a bunch of guys in the face&quot;</span><span class="p">,</span> <span class="s">&quot;r4&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m3&quot;</span><span class="p">,</span> <span class="s">&quot;Hobbs and Shaw&quot;</span><span class="p">,</span> <span class="s">&quot;Cars, Explosions and Stuff&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m4&quot;</span><span class="p">,</span> <span class="s">&quot;Jumanji&quot;</span><span class="p">,</span> <span class="s">&quot;The Rock smolders&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins></ins>
<ins>        <span class="n">insertActors</span><span class="p">(</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Jason Statham&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a2&quot;</span><span class="p">,</span> <span class="s">&quot;The Rock&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a3&quot;</span><span class="p">,</span> <span class="s">&quot;Shu Qi&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a4&quot;</span><span class="p">,</span> <span class="s">&quot;Amber Valletta&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a5&quot;</span><span class="p">,</span> <span class="s">&quot;Kevin Hart&quot;</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins>        <span class="n">insertRoles</span><span class="p">(</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m1&quot;</span><span class="p">,</span> <span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Frank Martin&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m1&quot;</span><span class="p">,</span> <span class="s">&quot;a3&quot;</span><span class="p">,</span> <span class="s">&quot;Lai&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m2&quot;</span><span class="p">,</span> <span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Frank Martin&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m2&quot;</span><span class="p">,</span> <span class="s">&quot;a4&quot;</span><span class="p">,</span> <span class="s">&quot;Audrey Billings&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m3&quot;</span><span class="p">,</span> <span class="s">&quot;a2&quot;</span><span class="p">,</span> <span class="s">&quot;Hobbs&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m3&quot;</span><span class="p">,</span> <span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Shaw&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m4&quot;</span><span class="p">,</span> <span class="s">&quot;a2&quot;</span><span class="p">,</span> <span class="s">&quot;Spencer&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m4&quot;</span><span class="p">,</span> <span class="s">&quot;a5&quot;</span><span class="p">,</span> <span class="s">&quot;Fridge&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins><span class="p">}</span></ins></pre>
</div>
</div>
</details>

<p>In the controller, we define the base path to use</p>
<details class="success" open>
<summary><a class="find-button" href="#030-base-path">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RestController.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>
<span class="k">private</span> <span class="k">val</span> <span class="py">notFoundRatingWithMovies</span> <span class="p">=</span> <span class="n">RatingWithMovies</span><span class="p">(</span><span class="n">notFoundRating</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">())</span>

<ins><span class="n">@Path</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span></ins>
<ins><span class="k">class</span> <span class="nc">RestController</span> <span class="p">{</span></ins>
    <span class="n">@GET</span>
    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">)</span>
    <span class="c1">// ...</span>
<span class="p">}</span></pre>
</div>
</div>
</details>

<p>and for each function we want to expose, we define the HTTP method type and extended path</p>
<details class="success" open>
<summary><a class="find-button" href="#030-simple-function">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RestController.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>

<span class="n">@Path</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RestController</span> <span class="p">{</span>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getRatings</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">ratingsByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">})</span></ins>

    <span class="n">@GET</span>
    <span class="c1">// ...</span>
<span class="p">}</span></pre>
</div>
</div>
</details>

<p>Functions can also have parameters, which Jersey will parse based on the path, then pass to
the function</p>
<details class="success" open>
<summary><a class="find-button" href="#030-function-with-parameters">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RestController.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>

<span class="n">@Path</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">RestController</span> <span class="p">{</span>
    <span class="c1">// ...</span>
    <span class="k">fun</span> <span class="nf">getActors</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">actorsByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">name</span> <span class="p">})</span>

<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}/movies&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getRatingWithMovies</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">RatingWithMovies</span> <span class="p">=</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">rating</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="k">val</span> <span class="py">movies</span> <span class="p">=</span> <span class="n">moviesByRatingIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span></ins>
<ins>            <span class="n">RatingWithMovies</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span> <span class="n">movies</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="o">?:</span> <span class="n">notFoundRatingWithMovies</span></ins>

    <span class="n">@GET</span>
    <span class="c1">// ...</span>
<span class="p">}</span></pre>
</div>
</div>
</details>

<p>I've created some helper functions to simplify setting up the response to send back to the client.</p>
<details class="success" open>
<summary><a class="find-button" href="#030-responses">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RestController.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>
<span class="c1">//       important for the class. The important thing is how we</span>
<span class="c1">//       can communicate with the server</span>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">response</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">Response</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="n">status</span><span class="p">).</span><span class="n">entity</span><span class="p">(</span><span class="n">entity</span><span class="p">).</span><span class="n">build</span><span class="p">()</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">ok</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">notFound</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">NOT_FOUND</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">created</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">CREATED</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>


<span class="c1">// ...</span></pre>
</div>
</div>
</details>

<p>Finally, we set up the actual server runner code</p>
<details class="example" open>
<summary><a class="find-button" href="#030-runner">show in full file</a>  restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RunServer.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span class="c1">// ...</span>
<span class="k">import</span> <span class="nn">jakarta.ws.rs.ext.Provider</span>

<ins><span class="c1">// from https://mkyong.com/webservices/jax-rs/json-example-with-jersey-jackson/</span></ins>
<ins><span class="c1">// MIT License</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">//  Copyright (c) 2020 Mkyong.com</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">// Permission is hereby granted, free of charge, to any person obtaining a copy</span></ins>
<ins><span class="c1">// of this software and associated documentation files (the “Software”), to deal</span></ins>
<ins><span class="c1">// in the Software without restriction, including without limitation the rights</span></ins>
<ins><span class="c1">// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></ins>
<ins><span class="c1">// copies of the Software, and to permit persons to whom the Software is</span></ins>
<ins><span class="c1">// furnished to do so, subject to the following conditions:</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">// The above copyright notice and this permission notice shall be included in all</span></ins>
<ins><span class="c1">// copies or substantial portions of the Software.</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">// THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></ins>
<ins><span class="c1">// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></ins>
<ins><span class="c1">// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></ins>
<ins><span class="c1">// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></ins>
<ins><span class="c1">// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></ins>
<ins><span class="c1">// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span></ins>
<ins><span class="c1">// SOFTWARE.</span></ins>
<ins></ins>
<span class="k">class</span> <span class="nc">RunServer</span> <span class="p">{</span>
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="n">@JvmStatic</span>
        <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
<del><span class="c1">//          <span class="n">println</span><span class="p">(</span><span class="s">&quot;It runs!&quot;</span><span class="p">)</span></span></del>
<ins>            <span class="n">GrizzlyHttpServerFactory</span></ins>
<ins>                <span class="p">.</span><span class="n">createHttpServer</span><span class="p">(</span></ins>
<ins>                    <span class="n">URI</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;http://localhost:8080&quot;</span><span class="p">),</span></ins>
<ins>                    <span class="n">ResourceConfig</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span></ins>
<ins>                        <span class="n">register</span><span class="p">(</span><span class="n">RestController</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span></ins>
<ins>                        <span class="n">register</span><span class="p">(</span><span class="n">CustomJacksonMapperProvider</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span></ins>
<ins>                    <span class="p">}</span></ins>
<ins>                <span class="p">).</span><span class="n">start</span><span class="p">()</span></ins>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<ins></ins>
<ins><span class="n">@Provider</span></ins>
<ins><span class="k">class</span> <span class="nc">CustomJacksonMapperProvider</span> <span class="p">:</span> <span class="n">ContextResolver</span><span class="p">&lt;</span><span class="n">ObjectMapper</span><span class="p">&gt;</span> <span class="p">{</span></ins>
<ins>    <span class="k">private</span> <span class="k">val</span> <span class="py">mapper</span> <span class="p">=</span> <span class="n">ObjectMapper</span><span class="p">().</span><span class="n">enable</span><span class="p">(</span><span class="n">SerializationFeature</span><span class="p">.</span><span class="n">INDENT_OUTPUT</span><span class="p">)</span></ins>
<ins>    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getContext</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="n">Class</span><span class="p">&lt;*&gt;?)</span> <span class="p">=</span> <span class="n">mapper</span></ins>
<ins><span class="p">}</span></ins>
</pre>
</div>
</div>
</details>

<p>When we run the server using</p>
<div class="highlight"><pre><span></span><code>./gradlew run
</code></pre></div>
<p>we'll see</p>
<div class="highlight"><pre><span></span><code>Dec 01, 2024 4:28:42 PM org.glassfish.jersey.server.wadl.WadlFeature configure
WARNING: JAXBContext implementation could not be found. WADL feature is disabled.
Dec 01, 2024 4:28:43 PM org.glassfish.grizzly.http.server.NetworkListener start
INFO: Started listener bound to [localhost:8080]
Dec 01, 2024 4:28:43 PM org.glassfish.grizzly.http.server.HttpServer start
INFO: [HttpServer] Started.
&lt;==========---&gt; 83% EXECUTING [18s]
&gt; :restserver:run
</code></pre></div>
<p>which indicates where you'll point your browser, <a href="http://localhost:8080">http://localhost:8080</a>,
for the root of the server.</p>
<p>If we browse to <a href="http://localhost:8080/movie">http://localhost:8080/movie</a>, we'll see</p>
<div class="highlight"><pre><span></span><code>[ ]
</code></pre></div>
<p>The movie list is currently empty, so we need to reset the "database" by browsing to
<a href="http://localhost:8080/reset">http://localhost:8080/reset</a>, which displays <code>1</code> for success.</p>
<p>Now if we go to <a href="http://localhost:8080/movie">http://localhost:8080/movie</a>, we see</p>
<div class="highlight"><pre><span></span><code><span class="p">[</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;m3&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hobbs and Shaw&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cars, Explosions and Stuff&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ratingId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;r3&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;m4&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Jumanji&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The Rock smolders&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ratingId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;r3&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;m1&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;The Transporter&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Jason Statham kicks a guy in the face&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ratingId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;r3&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;m2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Transporter 2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Jason Statham kicks a bunch of guys in the face&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ratingId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;r4&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">]</span>
</code></pre></div>
<p>returned from the server.</p>
<p>We've also included a function to fetch a specific movie (but we skipped actor and rating
as we did when not implementing their edit screens). If we go to
<a href="http://localhost:8080/movie/m3">http://localhost:8080/movie/m3</a>, we see</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;m3&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Hobbs and Shaw&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Cars, Explosions and Stuff&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;ratingId&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;r3&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Now that we have a server, we can implement a repository that makes REST requests to it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Because this is an in-memory server with no disk backup, you'll need to reset the
data whenever the server is restarted.</p>
</div>
<hr/>
<h2>All code changes</h2>
<details class="success" open>
<summary>ADDED: restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Actor.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><ins><span></span><span class="k">package</span> <span class="nn">com.androidbyexample.compose.movies.restserver</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.xml.bind.annotation.XmlRootElement</span></ins>
<ins><span class="k">import</span> <span class="nn">java.util.UUID</span></ins>
<ins></ins>
<div id="030-actor"><ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">Actor</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">id</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="n">UUID</span><span class="p">.</span><span class="n">randomUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">ActorWithFilmography</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;filmography&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">filmography</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">RoleWithMovie</span><span class="p">&gt;,</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">RoleWithMovie</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;character&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">character</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;orderInCredits&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">orderInCredits</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span></ins>
<ins><span class="p">)</span></ins>
</div></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Movie.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><ins><span></span><span class="k">package</span> <span class="nn">com.androidbyexample.compose.movies.restserver</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.xml.bind.annotation.XmlRootElement</span></ins>
<ins><span class="k">import</span> <span class="nn">java.util.UUID</span></ins>
<ins></ins>
<div id="030-movie"><ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">Movie</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">id</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="n">UUID</span><span class="p">.</span><span class="n">randomUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;title&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">title</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">description</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;ratingId&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">ratingId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">MovieWithCast</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;cast&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">cast</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">RoleWithActor</span><span class="p">&gt;,</span></ins>
<ins><span class="p">)</span></ins>
</div><ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">RoleWithActor</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;character&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">character</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;orderInCredits&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">orderInCredits</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span></ins>
<ins><span class="p">)</span></ins>
</pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Rating.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><ins><span></span><span class="k">package</span> <span class="nn">com.androidbyexample.compose.movies.restserver</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.xml.bind.annotation.XmlRootElement</span></ins>
<ins><span class="k">import</span> <span class="nn">java.util.UUID</span></ins>
<ins></ins>
<div id="030-rating"><ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">Rating</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">id</span><span class="p">:</span> <span class="n">String</span> <span class="p">=</span> <span class="n">UUID</span><span class="p">.</span><span class="n">randomUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;name&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">name</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;description&quot;</span><span class="p">)</span> <span class="k">val</span> <span class="py">description</span><span class="p">:</span> <span class="n">String</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">data</span> <span class="k">class</span> <span class="nc">RatingWithMovies</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">rating</span><span class="p">:</span> <span class="n">Rating</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movies&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">movies</span><span class="p">:</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Movie</span><span class="p">&gt;,</span></ins>
<ins><span class="p">)</span></ins>
</div></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RestController.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><ins><span></span><span class="k">package</span> <span class="nn">com.androidbyexample.compose.movies.restserver</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.Consumes</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.DELETE</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.GET</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.POST</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.PUT</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.Path</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.PathParam</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.Produces</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.core.Context</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.core.MediaType</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.core.Response</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.core.UriInfo</span></ins>
<ins></ins>
<ins></ins>
<div id="030-controller"><ins><span class="c1">// NOTE: If Room were cross platform I would have directly used</span></ins>
<ins><span class="c1">//       our data module to store things in a database in this</span></ins>
<ins><span class="c1">//       server. Unfortunately, it&#39;s Android-only, so I&#39;m</span></ins>
<ins><span class="c1">//       implementing an in-memory set of maps to track the</span></ins>
<ins><span class="c1">//       data. Kinda gross, but developing a real server isn&#39;t</span></ins>
<ins><span class="c1">//       important for the class. The important thing is how we</span></ins>
<ins><span class="c1">//       can communicate with the server</span></ins>
<div id="030-responses"><ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">response</span><span class="p">(</span><span class="n">status</span><span class="p">:</span> <span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">Response</span><span class="p">.</span><span class="n">status</span><span class="p">(</span><span class="n">status</span><span class="p">).</span><span class="n">entity</span><span class="p">(</span><span class="n">entity</span><span class="p">).</span><span class="n">build</span><span class="p">()</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">ok</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">notFound</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">NOT_FOUND</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="nf">created</span><span class="p">(</span><span class="n">entity</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>    <span class="n">response</span><span class="p">(</span><span class="n">Response</span><span class="p">.</span><span class="n">Status</span><span class="p">.</span><span class="n">CREATED</span><span class="p">,</span> <span class="n">entity</span><span class="p">)</span></ins>
</div><ins></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">moviesByIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Movie</span><span class="p">&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">actorsByIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Actor</span><span class="p">&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">ratingsByIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Rating</span><span class="p">&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">rolesByMovieIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Role</span><span class="p">&gt;&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">rolesByActorIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Role</span><span class="p">&gt;&gt;()</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">moviesByRatingIdIndex</span> <span class="p">=</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">Movie</span><span class="p">&gt;&gt;()</span></ins>
<ins></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundRating</span> <span class="p">=</span> <span class="n">Rating</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">)</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundMovie</span> <span class="p">=</span> <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">,</span> <span class="s">&quot;--&quot;</span><span class="p">)</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundMovieWithRoles</span> <span class="p">=</span> <span class="n">MovieWithCast</span><span class="p">(</span><span class="n">notFoundMovie</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">())</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundActor</span> <span class="p">=</span> <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">,</span> <span class="s">&quot;NOT FOUND&quot;</span><span class="p">)</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundActorWithRoles</span> <span class="p">=</span> <span class="n">ActorWithFilmography</span><span class="p">(</span><span class="n">notFoundActor</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">())</span></ins>
<ins><span class="k">private</span> <span class="k">val</span> <span class="py">notFoundRatingWithMovies</span> <span class="p">=</span> <span class="n">RatingWithMovies</span><span class="p">(</span><span class="n">notFoundRating</span><span class="p">,</span> <span class="n">emptyList</span><span class="p">())</span></ins>
<ins></ins>
<div id="030-base-path"><ins><span class="n">@Path</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)</span></ins>
<ins><span class="k">class</span> <span class="nc">RestController</span> <span class="p">{</span></ins>
</div><div id="030-simple-function"><ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getRatings</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">ratingsByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">})</span></ins>
</div><ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getMovies</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">title</span> <span class="p">})</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getMovie</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="n">ok</span><span class="p">(</span><span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">])</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getActors</span><span class="p">():</span> <span class="n">Response</span> <span class="p">=</span> <span class="n">ok</span><span class="p">(</span><span class="n">actorsByIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">name</span> <span class="p">})</span></ins>
<ins></ins>
<div id="030-function-with-parameters"><ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}/movies&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getRatingWithMovies</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">RatingWithMovies</span> <span class="p">=</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">rating</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="k">val</span> <span class="py">movies</span> <span class="p">=</span> <span class="n">moviesByRatingIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span></ins>
<ins>            <span class="n">RatingWithMovies</span><span class="p">(</span><span class="n">rating</span><span class="p">,</span> <span class="n">movies</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="o">?:</span> <span class="n">notFoundRatingWithMovies</span></ins>
</div><ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}/cast&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getMovieWithRoles</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">MovieWithCast</span> <span class="p">=</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">movie</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="k">val</span> <span class="py">roles</span> <span class="p">=</span></ins>
<ins>                <span class="n">rolesByMovieIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span></ins>
<ins>                    <span class="o">?.</span><span class="n">map</span> <span class="p">{</span> <span class="n">role</span> <span class="p">-&gt;</span></ins>
<ins>                        <span class="n">RoleWithActor</span><span class="p">(</span></ins>
<ins>                            <span class="n">actor</span> <span class="p">=</span> <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">role</span><span class="p">.</span><span class="n">actorId</span><span class="p">]</span> <span class="o">?:</span> <span class="k">throw</span> <span class="n">IllegalStateException</span><span class="p">(),</span></ins>
<ins>                            <span class="n">character</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">character</span><span class="p">,</span></ins>
<ins>                            <span class="n">orderInCredits</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">orderInCredits</span><span class="p">,</span></ins>
<ins>                        <span class="p">)</span></ins>
<ins>                    <span class="p">}</span></ins>
<ins>                    <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span></ins>
<ins></ins>
<ins>            <span class="n">MovieWithCast</span><span class="p">(</span><span class="n">movie</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="o">?:</span> <span class="n">notFoundMovieWithRoles</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}/filmography&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">getActorWithRoles</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">ActorWithFilmography</span> <span class="p">=</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">let</span> <span class="p">{</span> <span class="n">actor</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="k">val</span> <span class="py">roles</span> <span class="p">=</span></ins>
<ins>                <span class="n">rolesByActorIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span></ins>
<ins>                    <span class="o">?.</span><span class="n">map</span> <span class="p">{</span> <span class="n">role</span> <span class="p">-&gt;</span></ins>
<ins>                        <span class="n">RoleWithMovie</span><span class="p">(</span></ins>
<ins>                            <span class="n">movie</span> <span class="p">=</span> <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">role</span><span class="p">.</span><span class="n">movieId</span><span class="p">]</span> <span class="o">?:</span> <span class="k">throw</span> <span class="n">IllegalStateException</span><span class="p">(),</span></ins>
<ins>                            <span class="n">character</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">character</span><span class="p">,</span></ins>
<ins>                            <span class="n">orderInCredits</span> <span class="p">=</span> <span class="n">role</span><span class="p">.</span><span class="n">orderInCredits</span><span class="p">,</span></ins>
<ins>                        <span class="p">)</span></ins>
<ins>                    <span class="p">}</span></ins>
<ins>                    <span class="o">?:</span> <span class="n">emptyList</span><span class="p">()</span></ins>
<ins>            <span class="n">ActorWithFilmography</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">roles</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="o">?:</span> <span class="n">notFoundActorWithRoles</span></ins>
<ins></ins>
<ins>    <span class="n">@PUT</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">updateMovie</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">movie</span></ins>
<ins>        <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">getOrPut</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="n">ratingId</span><span class="p">)</span> <span class="p">{</span> <span class="n">mutableListOf</span><span class="p">()</span> <span class="p">}.</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@PUT</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">updateActor</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">actor</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@PUT</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">updateRating</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">rating</span><span class="p">:</span> <span class="n">Rating</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">rating</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">operator</span> <span class="k">fun</span> <span class="nf">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Role</span><span class="p">&gt;&gt;.</span><span class="k">set</span><span class="p">(</span><span class="n">id1</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">id2</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">role</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="k">val</span> <span class="py">roles</span> <span class="p">=</span> <span class="k">this</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span> <span class="o">?:</span> <span class="n">mutableMapOf</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Role</span><span class="p">&gt;().</span><span class="n">apply</span> <span class="p">{</span> <span class="k">this</span><span class="n">@set</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span> <span class="p">=</span> <span class="k">this</span> <span class="p">}</span></ins>
<ins>        <span class="n">roles</span><span class="p">[</span><span class="n">id2</span><span class="p">]</span> <span class="p">=</span> <span class="n">role</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">operator</span> <span class="k">fun</span> <span class="nf">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">MutableMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Role</span><span class="p">&gt;&gt;.</span><span class="k">get</span><span class="p">(</span><span class="n">id1</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span> <span class="n">id2</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>        <span class="k">this</span><span class="p">[</span><span class="n">id1</span><span class="p">]</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="n">id2</span><span class="p">)</span></ins>
<ins></ins>
<ins>    <span class="n">@POST</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">createRating</span><span class="p">(</span><span class="n">@Context</span> <span class="n">uriInfo</span><span class="p">:</span> <span class="n">UriInfo</span><span class="p">,</span> <span class="n">rating</span><span class="p">:</span> <span class="n">Rating</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">rating</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">rating</span></ins>
<ins>        <span class="k">return</span> <span class="n">created</span><span class="p">(</span><span class="n">rating</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@POST</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">createMovie</span><span class="p">(</span><span class="n">@Context</span> <span class="n">uriInfo</span><span class="p">:</span> <span class="n">UriInfo</span><span class="p">,</span> <span class="n">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">movie</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">movie</span></ins>
<ins>        <span class="k">return</span> <span class="n">created</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@POST</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">createActor</span><span class="p">(</span><span class="n">@Context</span> <span class="n">uriInfo</span><span class="p">:</span> <span class="n">UriInfo</span><span class="p">,</span> <span class="n">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">):</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">actor</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">actor</span></ins>
<ins>        <span class="k">return</span> <span class="n">created</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@DELETE</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;movie/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">deleteMovie</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="k">if</span> <span class="p">(</span><span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>            <span class="n">notFound</span><span class="p">(</span><span class="m">0</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></ins>
<ins>            <span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">movies</span> <span class="p">-&gt;</span></ins>
<ins>                <span class="n">movies</span><span class="p">.</span><span class="n">removeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">==</span> <span class="n">id</span><span class="p">}</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">// remove all roles</span></ins>
<ins>            <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">roles</span> <span class="p">-&gt;</span></ins>
<ins>                <span class="n">roles</span><span class="p">.</span><span class="n">removeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">movieId</span> <span class="p">==</span> <span class="n">id</span> <span class="p">}</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@DELETE</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;actor/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">deleteActor</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="k">if</span> <span class="p">(</span><span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>            <span class="n">notFound</span><span class="p">(</span><span class="m">0</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></ins>
<ins>            <span class="n">actorsByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">// remove all roles</span></ins>
<ins>            <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">values</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">roles</span> <span class="p">-&gt;</span> <span class="c1">// remove filmography for those movies</span></ins>
<ins>                <span class="n">roles</span><span class="p">.</span><span class="n">removeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">actorId</span> <span class="p">==</span> <span class="n">id</span> <span class="p">}</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@DELETE</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;rating/{id}&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Consumes</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">APPLICATION_JSON</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">deleteRating</span><span class="p">(</span><span class="n">@PathParam</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">)</span> <span class="n">id</span><span class="p">:</span> <span class="n">String</span><span class="p">):</span> <span class="n">Response</span> <span class="p">=</span></ins>
<ins>        <span class="k">if</span> <span class="p">(</span><span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>            <span class="n">notFound</span><span class="p">(</span><span class="m">0</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></ins>
<ins>            <span class="n">ratingsByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="c1">// delete associated movies</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">[</span><span class="n">id</span><span class="p">]</span><span class="o">?.</span><span class="n">forEach</span> <span class="p">{</span></ins>
<ins>                <span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="p">}</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">id</span><span class="p">)</span></ins>
<ins>            <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertMovies</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newMovies</span><span class="p">:</span> <span class="n">Movie</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newMovies</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">movie</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">moviesByIdIndex</span><span class="p">[</span><span class="n">movie</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">movie</span></ins>
<ins>            <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">movie</span><span class="p">.</span><span class="n">ratingId</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">movie</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertActors</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newActors</span><span class="p">:</span> <span class="n">Actor</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newActors</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">actor</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">actorsByIdIndex</span><span class="p">[</span><span class="n">actor</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">actor</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertRatings</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newRatings</span><span class="p">:</span> <span class="n">Rating</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newRatings</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">rating</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">ratingsByIdIndex</span><span class="p">[</span><span class="n">rating</span><span class="p">.</span><span class="n">id</span><span class="p">]</span> <span class="p">=</span> <span class="n">rating</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="nf">insertRoles</span><span class="p">(</span><span class="k">vararg</span> <span class="n">newRoles</span><span class="p">:</span> <span class="n">Role</span><span class="p">)</span> <span class="p">{</span></ins>
<ins>        <span class="n">newRoles</span><span class="p">.</span><span class="n">forEach</span> <span class="p">{</span> <span class="n">role</span> <span class="p">-&gt;</span></ins>
<ins>            <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">role</span><span class="p">.</span><span class="n">actorId</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">role</span><span class="p">)</span></ins>
<ins>            <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">role</span><span class="p">.</span><span class="n">movieId</span><span class="p">).</span><span class="n">add</span><span class="p">(</span><span class="n">role</span><span class="p">)</span></ins>
<ins>        <span class="p">}</span></ins>
<ins>    <span class="p">}</span></ins>
<ins>    <span class="k">private</span> <span class="k">fun</span> <span class="p">&lt;</span><span class="n">K</span>, <span class="n">V</span><span class="p">&gt;</span> <span class="nf">MutableMap</span><span class="p">&lt;</span><span class="n">K</span><span class="p">,</span> <span class="n">MutableList</span><span class="p">&lt;</span><span class="n">V</span><span class="p">&gt;&gt;.</span><span class="n">getOrCreate</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="n">K</span><span class="p">)</span> <span class="p">=</span></ins>
<ins>        <span class="k">this</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">?:</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="n">V</span><span class="p">&gt;().</span><span class="n">apply</span> <span class="p">{</span></ins>
<ins>            <span class="k">this</span><span class="n">@getOrCreate</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="p">=</span> <span class="k">this</span></ins>
<ins>        <span class="p">}</span></ins>
<ins></ins>
<ins>    <span class="n">@GET</span></ins>
<ins>    <span class="n">@Path</span><span class="p">(</span><span class="s">&quot;reset&quot;</span><span class="p">)</span></ins>
<ins>    <span class="n">@Produces</span><span class="p">(</span><span class="n">MediaType</span><span class="p">.</span><span class="n">TEXT_PLAIN</span><span class="p">)</span></ins>
<ins>    <span class="k">fun</span> <span class="nf">resetDatabase</span><span class="p">():</span> <span class="n">Response</span> <span class="p">{</span></ins>
<ins>        <span class="n">ratingsByIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">moviesByIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">actorsByIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">rolesByActorIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">rolesByMovieIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins>        <span class="n">moviesByRatingIdIndex</span><span class="p">.</span><span class="n">clear</span><span class="p">()</span></ins>
<ins></ins>
<ins>        <span class="n">insertRatings</span><span class="p">(</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r0&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;Not Rated&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Not yet rated&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r1&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;G&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;General Audiences&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r2&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;PG&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Parental Guidance Suggested&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r3&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;PG-13&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Unsuitable for those under 13&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Rating</span><span class="p">(</span><span class="n">id</span> <span class="p">=</span> <span class="s">&quot;r4&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="p">=</span> <span class="s">&quot;R&quot;</span><span class="p">,</span> <span class="n">description</span> <span class="p">=</span> <span class="s">&quot;Restricted - 17 and older&quot;</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins></ins>
<ins>        <span class="n">insertMovies</span><span class="p">(</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m1&quot;</span><span class="p">,</span> <span class="s">&quot;The Transporter&quot;</span><span class="p">,</span> <span class="s">&quot;Jason Statham kicks a guy in the face&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m2&quot;</span><span class="p">,</span> <span class="s">&quot;Transporter 2&quot;</span><span class="p">,</span> <span class="s">&quot;Jason Statham kicks a bunch of guys in the face&quot;</span><span class="p">,</span> <span class="s">&quot;r4&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m3&quot;</span><span class="p">,</span> <span class="s">&quot;Hobbs and Shaw&quot;</span><span class="p">,</span> <span class="s">&quot;Cars, Explosions and Stuff&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Movie</span><span class="p">(</span><span class="s">&quot;m4&quot;</span><span class="p">,</span> <span class="s">&quot;Jumanji&quot;</span><span class="p">,</span> <span class="s">&quot;The Rock smolders&quot;</span><span class="p">,</span> <span class="s">&quot;r3&quot;</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins></ins>
<ins>        <span class="n">insertActors</span><span class="p">(</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Jason Statham&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a2&quot;</span><span class="p">,</span> <span class="s">&quot;The Rock&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a3&quot;</span><span class="p">,</span> <span class="s">&quot;Shu Qi&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a4&quot;</span><span class="p">,</span> <span class="s">&quot;Amber Valletta&quot;</span><span class="p">),</span></ins>
<ins>            <span class="n">Actor</span><span class="p">(</span><span class="s">&quot;a5&quot;</span><span class="p">,</span> <span class="s">&quot;Kevin Hart&quot;</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins>        <span class="n">insertRoles</span><span class="p">(</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m1&quot;</span><span class="p">,</span> <span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Frank Martin&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m1&quot;</span><span class="p">,</span> <span class="s">&quot;a3&quot;</span><span class="p">,</span> <span class="s">&quot;Lai&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m2&quot;</span><span class="p">,</span> <span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Frank Martin&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m2&quot;</span><span class="p">,</span> <span class="s">&quot;a4&quot;</span><span class="p">,</span> <span class="s">&quot;Audrey Billings&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m3&quot;</span><span class="p">,</span> <span class="s">&quot;a2&quot;</span><span class="p">,</span> <span class="s">&quot;Hobbs&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m3&quot;</span><span class="p">,</span> <span class="s">&quot;a1&quot;</span><span class="p">,</span> <span class="s">&quot;Shaw&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m4&quot;</span><span class="p">,</span> <span class="s">&quot;a2&quot;</span><span class="p">,</span> <span class="s">&quot;Spencer&quot;</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span></ins>
<ins>            <span class="n">Role</span><span class="p">(</span><span class="s">&quot;m4&quot;</span><span class="p">,</span> <span class="s">&quot;a5&quot;</span><span class="p">,</span> <span class="s">&quot;Fridge&quot;</span><span class="p">,</span> <span class="m">2</span><span class="p">),</span></ins>
<ins>        <span class="p">)</span></ins>
<ins>        <span class="k">return</span> <span class="n">ok</span><span class="p">(</span><span class="m">1</span><span class="p">)</span></ins>
<ins>    <span class="p">}</span></ins>
<ins><span class="p">}</span></ins>
</div></pre>
</div>
</div>
</details>
<details class="success" open>
<summary>ADDED: restserver/src/main/java/com/androidbyexample/compose/movies/restserver/Role.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><ins><span></span><span class="k">package</span> <span class="nn">com.androidbyexample.compose.movies.restserver</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">com.fasterxml.jackson.annotation.JsonProperty</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.xml.bind.annotation.XmlRootElement</span></ins>
<ins></ins>
<div id="030-role"><ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">class</span> <span class="nc">Role</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movieId&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">movieId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;actorId&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">actorId</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;character&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">character</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;orderInCredits&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">orderInCredits</span><span class="p">:</span> <span class="n">Int</span></ins>
<ins><span class="p">)</span></ins>
<ins></ins>
<ins><span class="n">@XmlRootElement</span></ins>
<ins><span class="k">class</span> <span class="nc">ExpandedRole</span><span class="p">(</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;movie&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">movie</span><span class="p">:</span> <span class="n">Movie</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;actor&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">actor</span><span class="p">:</span> <span class="n">Actor</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;character&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">character</span><span class="p">:</span> <span class="n">String</span><span class="p">,</span></ins>
<ins>    <span class="n">@JsonProperty</span><span class="p">(</span><span class="s">&quot;orderInCredits&quot;</span><span class="p">)</span> <span class="k">var</span> <span class="py">orderInCredits</span><span class="p">:</span> <span class="n">Int</span></ins>
<ins><span class="p">)</span></ins>
</div></pre>
</div>
</div>
</details>
<details class="example" open>
<summary>CHANGED: restserver/src/main/java/com/androidbyexample/compose/movies/restserver/RunServer.kt</summary>
<div class="sas1-code-block">
<div class="highlight">
<pre><span></span><span class="k">package</span> <span class="nn">com.androidbyexample.compose.movies.restserver</span>

<ins><span class="k">import</span> <span class="nn">org.glassfish.jersey.grizzly2.httpserver.GrizzlyHttpServerFactory</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">org.glassfish.jersey.server.ResourceConfig</span></ins>
<ins><span class="k">import</span> <span class="nn">java.net.URI</span></ins>
<ins><span class="k">import</span> <span class="nn">com.fasterxml.jackson.databind.ObjectMapper</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">com.fasterxml.jackson.databind.SerializationFeature</span></ins>
<ins></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.ext.ContextResolver</span></ins>
<ins><span class="k">import</span> <span class="nn">jakarta.ws.rs.ext.Provider</span></ins>
<ins></ins>
<div id="030-runner"><ins><span class="c1">// from https://mkyong.com/webservices/jax-rs/json-example-with-jersey-jackson/</span></ins>
<ins><span class="c1">// MIT License</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">//  Copyright (c) 2020 Mkyong.com</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">// Permission is hereby granted, free of charge, to any person obtaining a copy</span></ins>
<ins><span class="c1">// of this software and associated documentation files (the “Software”), to deal</span></ins>
<ins><span class="c1">// in the Software without restriction, including without limitation the rights</span></ins>
<ins><span class="c1">// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></ins>
<ins><span class="c1">// copies of the Software, and to permit persons to whom the Software is</span></ins>
<ins><span class="c1">// furnished to do so, subject to the following conditions:</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">// The above copyright notice and this permission notice shall be included in all</span></ins>
<ins><span class="c1">// copies or substantial portions of the Software.</span></ins>
<ins><span class="c1">//</span></ins>
<ins><span class="c1">// THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></ins>
<ins><span class="c1">// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></ins>
<ins><span class="c1">// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></ins>
<ins><span class="c1">// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></ins>
<ins><span class="c1">// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></ins>
<ins><span class="c1">// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span></ins>
<ins><span class="c1">// SOFTWARE.</span></ins>
<ins></ins>
<span class="k">class</span> <span class="nc">RunServer</span> <span class="p">{</span>
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="n">@JvmStatic</span>
        <span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">{</span>
<del><span class="c1">//          <span class="n">println</span><span class="p">(</span><span class="s">&quot;It runs!&quot;</span><span class="p">)</span></span></del>
<ins>            <span class="n">GrizzlyHttpServerFactory</span></ins>
<ins>                <span class="p">.</span><span class="n">createHttpServer</span><span class="p">(</span></ins>
<ins>                    <span class="n">URI</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="s">&quot;http://localhost:8080&quot;</span><span class="p">),</span></ins>
<ins>                    <span class="n">ResourceConfig</span><span class="p">().</span><span class="n">apply</span> <span class="p">{</span></ins>
<ins>                        <span class="n">register</span><span class="p">(</span><span class="n">RestController</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span></ins>
<ins>                        <span class="n">register</span><span class="p">(</span><span class="n">CustomJacksonMapperProvider</span><span class="o">::</span><span class="k">class</span><span class="p">.</span><span class="n">java</span><span class="p">)</span></ins>
<ins>                    <span class="p">}</span></ins>
<ins>                <span class="p">).</span><span class="n">start</span><span class="p">()</span></ins>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<ins></ins>
<ins><span class="n">@Provider</span></ins>
<ins><span class="k">class</span> <span class="nc">CustomJacksonMapperProvider</span> <span class="p">:</span> <span class="n">ContextResolver</span><span class="p">&lt;</span><span class="n">ObjectMapper</span><span class="p">&gt;</span> <span class="p">{</span></ins>
<ins>    <span class="k">private</span> <span class="k">val</span> <span class="py">mapper</span> <span class="p">=</span> <span class="n">ObjectMapper</span><span class="p">().</span><span class="n">enable</span><span class="p">(</span><span class="n">SerializationFeature</span><span class="p">.</span><span class="n">INDENT_OUTPUT</span><span class="p">)</span></ins>
<ins>    <span class="k">override</span> <span class="k">fun</span> <span class="nf">getContext</span><span class="p">(</span><span class="n">type</span><span class="p">:</span> <span class="n">Class</span><span class="p">&lt;*&gt;?)</span> <span class="p">=</span> <span class="n">mapper</span></ins>
<ins><span class="p">}</span></ins>
<ins></ins>
</div></pre>
</div>
</div>
</details>


              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2025. Scott Stanchfield
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.sections", "search.suggest", "search.highlight", "navigation.instant", "content.tabs.link", "toc.follow", "toc.integrate", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>